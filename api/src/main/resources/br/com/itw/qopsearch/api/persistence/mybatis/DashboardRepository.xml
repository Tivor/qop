<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="br.com.itw.qopsearch.api.persistence.mybatis.DashboardRepository">

    <resultMap id="histogramDto" type="br.com.itw.qopsearch.domain.dto.HistogramDto">
        <result column="label" property="label"/>
        <result column="value" property="value"/>
    </resultMap>

	<select id="allCount" resultMap="histogramDto">
        select * from (
            (select 'Feature' as label, count(*) as value from feature) union
            (select 'Feature needs' as label, count(*) as value from feature_needs) union
            (select 'Product' as label, count(*) as value from product)
        ) allCount
	</select>

    <select id="getFeatureProductCollectionWithSumFeatureSpecificationValue" resultMap="histogramDto">
        select * from (
            select
                Feature.id ,
                Feature.name as label,
                NVL( sum(ofeature.specification_value), 0) as value
            from feature Feature
            inner join feature_product o on o.id = Feature.id
            group by Feature.id, Feature.name
            order by sum(ofeature.specification_value) desc
        ) where rownum <![CDATA[ < ]]> 11
    </select>
    <select id="getFeatureProductCollectionWithSumProductSpecificationValue" resultMap="histogramDto">
        select * from (
            select
                Product.id ,
                Product.description as label,
                NVL( sum(oproduct.specification_value), 0) as value
            from product Product
            inner join feature_product o on o.id = Product.id
            group by Product.id, Product.description
            order by sum(oproduct.specification_value) desc
        ) where rownum <![CDATA[ < ]]> 11
    </select>


</mapper>
